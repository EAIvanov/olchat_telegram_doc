# Как отправить сообщение в Telegram если номер телефона клиента скрыт?

{% hint style="warning" %}
Функционал роботов в лидах и сделках доступен для тарифов Базовый, Стандартный, Профессиональный и Энтерпрайз

Функционал активити (действий) бизнес-процессов доступен для тарифов Профессиональный и Энтерпрайз
{% endhint %}

Для отправки сообщения клиенту в Telegram в случае, когда вам неизвестен его номер, вы можете воспользоваться отправкой сообщения в чат по ID чата. ID чата хранится в поле Мессенджер.

В поле Мессенджер хранится специальная конструкция, которая имеет вид:

<figure><img src="../.gitbook/assets/image (1005).png" alt=""><figcaption></figcaption></figure>

ID чата в данной конструкции хранится на третьем месте, после символа |

<figure><img src="../.gitbook/assets/image (1006).png" alt=""><figcaption></figcaption></figure>

Чтобы из данной конструкции выделить ID чата и использовать его в дальнейшем для отправки в чат сообщения, можно воспользоваться специальной комбинацией формул:

```
{{=firstvalue(swirl(swirl(swirl(explode('|', "Значение поля Мессенджер")))))}}
```

Как работает данная комбинация формул:

1. **«Значение поля Мессенджер».** Поскольку поле Мессенджер множественное, укажите явно, в каком именно значении множественного поля Мессенджер у вас хранится ID чата и которое впоследствии будет использовано в формуле. Например, значение содержащееся в **\{{Контакт Открытая линия (текст)\}}**
2. С помощью формулы [**explode**](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=57\&LESSON_ID=4912\&LESSON_PATH=5442.5446.5059.4912#explode) мы разделяем значения поля **\{{Контакт Открытая линия (текст)\}}** на несколько подзначений с помощью разделителя **|**
3. С помощью формулы [**swirl**](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=57\&LESSON_ID=4912\&LESSON_PATH=5442.5446.5059.4912#swirl)**,** последовательно применённой 3 раза, мы перемещаем подзначение ID чата с 3-го на первое место.
4. С помощью формулы [**firstvalue**](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=57\&LESSON_ID=4912\&LESSON_PATH=5442.5446.5059.4912#firstvalue) мы забираем из строки с подзначениями то, которое стоит на первом месте

Далее, можно переходить к настройкам робота:

<figure><img src="../.gitbook/assets/image (1568).png" alt=""><figcaption></figcaption></figure>

1. В поле «Тип идентификатора чата» из выпадающего списка выберите значение «ID чата»
2. В поле «Идентификатор чата» укажите составленную комбинацию формул
3. Напишите текст сообщения
4. Сохраните настройки робота нажав на кнопку «СОХРАНИТЬ»

Если вы используете в работе бизнес процессы, вы можете настроить активити бизнес-процесса следующим образом:

<figure><img src="../.gitbook/assets/image (1009).png" alt=""><figcaption></figcaption></figure>

1. В поле «Тип идентификатора чата» из выпадающего списка выберите значение «ID чата»
2. В поле «Идентификатор чата» укажите составленную комбинацию формул
3. Напишите текст сообщения
4. Сохраните настройки активити нажав на кнопку «Сохранить»
