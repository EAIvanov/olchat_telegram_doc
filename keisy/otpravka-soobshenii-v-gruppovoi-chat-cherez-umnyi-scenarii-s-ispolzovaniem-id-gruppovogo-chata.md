# Отправка сообщений в групповой чат через умный сценарий с использованием ID группового чата

Для отправки сообщений в групповой чат Telegram необходимо знать ID группового чата.&#x20;

ID чата хранится в поле Мессенджер. В поле Мессенджер хранится специальная конструкция. \
ID чата в данной конструкции хранится на третьем месте, после символа |

<figure><img src="../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

Чтобы из данной конструкции выделить ID чата и использовать его в дальнейшем для отправки в чат сообщения, можно воспользоваться специальной комбинацией формул:

```
{{=firstvalue(swirl(swirl(swirl(explode('|', "Значение поля Мессенджер")))))}}
```

Как работает данная комбинация формул:

1. **«Значение поля Мессенджер».** Поскольку поле Мессенджер множественное, укажите явно, в каком именно значении множественного поля Мессенджер у вас хранится ID чата и которое впоследствии будет использовано в формуле. Например, значение содержащееся в **\{{Контакт Открытая линия (текст)\}}**
2. С помощью формулы [**explode**](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=57\&LESSON_ID=4912\&LESSON_PATH=5442.5446.5059.4912#explode) мы разделяем значения поля **\{{Контакт Открытая линия (текст)\}}** на несколько подзначений с помощью разделителя **|**
3. С помощью формулы [**swirl**](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=57\&LESSON_ID=4912\&LESSON_PATH=5442.5446.5059.4912#swirl)**,** последовательно применённой 3 раза, мы перемещаем подзначение ID чата с 3-го на первое место.
4. С помощью формулы [**firstvalue**](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=57\&LESSON_ID=4912\&LESSON_PATH=5442.5446.5059.4912#firstvalue) мы забираем из строки с подзначениями то, которое стоит на первом месте



Далее, можно переходить к настройкам Умного сценария.

Умные сценарии в Битрикс24 позволяют автоматизировать работу с лидами, сделками, контактами и компаниями. С помощью умных сценариев вы можете настроить последовательность роботов, которые совершат нужные действия для выбранных сущностей.

В умных сценариях доступны все роботы приложения OLChat.

Создадим умный сценарий, который будет отправлять сообщения клиентам в WhatsApp по выбранным сделкам. Для этого в вашем Битрикс24 необходимо перейти в раздел **CRM ‒ Сделки ‒ Список сценариев ‒ Умные сценарии ‒ Создать сценарий.**

<figure><img src="../.gitbook/assets/image (1010).png" alt=""><figcaption></figcaption></figure>

В открывшемся окне укажите название и описание сценария.

<figure><img src="../.gitbook/assets/image (1011).png" alt=""><figcaption></figcaption></figure>

В разделе "Роботы" добавим робота, который будет выполнять отправку сообщения в Telegram. Для этого необходимо нажать кнопку **+добавить ‒ Другие роботы ‒ \[OLChat ‒ Чаты и Группы Telegram] Отправка сообщения.**

Выполните настройку робота:

<figure><img src="../.gitbook/assets/image (1568).png" alt=""><figcaption></figcaption></figure>

1. В поле «Тип идентификатора чата» из выпадающего списка выберите значение «ID чата»
2. В поле «Идентификатор чата» укажите составленную комбинацию формул

```
{{=firstvalue(swirl(swirl(swirl(explode('|', {{Контакт Открытая линия (текст)}})))))}}
```

3. Напишите текст сообщения
4. Сохраните настройки робота, нажав на кнопку «Сохранить»

Умный сценарий готов и можно переходить к его запуску.

Чтобы запустить умный сценарий, отметьте необходимые сущности, перейдите в **Список сценариев ‒ Умные сценарии ‒ Отправка сообщения.** Сценарий запустится и выполнит указанные в нём действия.

<figure><img src="../.gitbook/assets/image (1012).png" alt=""><figcaption></figcaption></figure>

Чтобы отредактировать созданный сценарий, необходимо перейти в список сценариев.

<figure><img src="../.gitbook/assets/image (1013).png" alt=""><figcaption></figcaption></figure>

В открывшемся окне вы увидите список всех доступных сценариев. Чтобы удалить или настроить сценарий, используйте соответствующие действия.

<figure><img src="../.gitbook/assets/image (1014).png" alt=""><figcaption></figcaption></figure>
